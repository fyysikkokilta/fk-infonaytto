<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="../lib/jquery-3.3.1.min.js"></script>
<style>
body {
    background: white;
    font-family: sans-serif;
}
</style>
</head>
<body>
</body>
<script type="text/javascript">
  const restaurants = {
    1: "Kvarkki",
    2: "T-talo",
    3: "Täffä",
    5: "Alvari",
    //7: "TUAS",
    //8: "Valimo",
    45: "Dipoli",
    50: "Kipsari",
    //51: "Studio Kipsari",
    52: "A Bloc",
  }

  //TODO: align properties (G L V etc) to the right
  //TODO: if all restaurants don't fit on one page, add a URL parameter to show only part of the restaurants

  const restaurantIDs = Object.keys(restaurants).join(",");
  const today = (new Date()).toISOString().substring(0, 10);
  $.getJSON(`https://kitchen.kanttiinit.fi/menus?lang=fi&restaurants=${restaurantIDs}&days=${today}`,
      //NOTE: requires CORS extension in browser to work
      function(data) {
        const template = document.getElementById("restaurant-info-template");

        Object.keys(restaurants).forEach((id) => {
          //console.log(id, restaurants[id], data[id][today]);

          const node = document.createElement("div");
          node.classList.add("restaurant-container");

          const restaurantName = restaurants[id];

          const itemsHTML = data[id][today].map((item) => {
            //TODO: string replacements ('juusto' -> 'kämä' etc)
            //TODO: group wicked rabbit, 'grillistä' etc. consider separate handlers for alvari etc
            //TODO: if no items are found (e.g. saturday), display 'ei ruokalistaa saatavilla' or something
            const title = item.title;
            const props = item.properties.join(", ");
            return `
              <div class="restaurant-item">
              <span class="restaurant-item-title">${title}</span>
              <span class="restaurant-item-properties">${props}</span>
              </div>`;
          }).join("");

          console.log("itemsHTML", itemsHTML);

          const nodeHTML = `
            <h4 class="restaurant-name">${restaurantName}</h4>
            ${itemsHTML}
            </div>`;

          node.innerHTML = nodeHTML;

          document.body.appendChild(node);
        });
  });

</script>
</html>
